
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>FM Synthesis for Musical Instruments: Lab P-7: 4&amp;5 Lab Exercise</title><meta name="generator" content="MATLAB 9.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-05-04"><meta name="DC.source" content="main.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>FM Synthesis for Musical Instruments: Lab P-7: 4&amp;5 Lab Exercise</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Preparation</a></li><li><a href="#2">4.1 Generating the Bell Envelopes</a></li><li><a href="#3">4.2 Parameters for the Bell</a></li><li><a href="#4">4.3 The Bell Sound</a></li><li><a href="#5">a) Play the sound in each case</a></li><li><a href="#6">b) Calculate the fundamental frequency in each case</a></li><li><a href="#7">Result of fo</a></li><li><a href="#8">c) Sounds comparing with I(t)</a></li><li><a href="#9">d) Spectrogram and I(t)</a></li><li><a href="#10">e) Compare between bell wave with A(t)</a></li><li><a href="#11">f) Plot of 100-200 samples</a></li><li><a href="#12">4.4 Comments about the Bell</a></li><li><a href="#13">5 C-Major Scale</a></li><li><a href="#14">Function: Bell Envelope</a></li><li><a href="#15">Function: Bell</a></li><li><a href="#16">Function: Instantaneous Frequency</a></li></ul></div><h2 id="1">Preparation</h2><p>Clear the workspace and console</p><pre class="codeinput">clc;
clear;
</pre><h2 id="2">4.1 Generating the Bell Envelopes</h2><p>The function of the bell envelope is shown at the end of this script.</p><h2 id="3">4.2 Parameters for the Bell</h2><p>The function of the bell sound generator is shown at the end of this script. It also generates amplitude envelope A(t) and modulation index envelope I(t).</p><h2 id="4">4.3 The Bell Sound</h2><p>Test the bell function by changing different parameters in 6 different cases.</p><pre class="codeinput"><span class="comment">% Generate ff -&gt; fc &amp; fm</span>
ff1 = [110 220];
ff2 = [220 440];
ff3 = [110 220];
ff4 = [110 220];
ff5 = [250 350];
ff6 = [250 350];

<span class="comment">% Generate Io</span>
Io1 = 10;
Io2 = 5;
Io3 = 10;
Io4 = 10;
Io5 = 5;
Io6 = 3;

<span class="comment">% Generate tau</span>
tau1 = 2;
tau2 = 2;
tau3 = 12;
tau4 = 0.3;
tau5 = 2;
tau6 = 1;

<span class="comment">% Generate duration time Tdur</span>
dur1 = 6;
dur2 = 6;
dur3 = 3;
dur4 = 3;
dur5 = 5;
dur6 = 5;

<span class="comment">% Generate fsamp (11025 Hz as default)</span>
fsamp = 11025;

<span class="comment">% Generate the time sequence t</span>
t1 = 0:1/fsamp:dur1;
t2 = 0:1/fsamp:dur2;
t3 = 0:1/fsamp:dur3;
t4 = 0:1/fsamp:dur4;
t5 = 0:1/fsamp:dur5;
t6 = 0:1/fsamp:dur6;

<span class="comment">% Generate the bell sounds in 6 cases</span>
xx1 = bell(ff1,Io1,tau1,dur1,fsamp);
xx2 = bell(ff2,Io2,tau2,dur2,fsamp);
xx3 = bell(ff3,Io3,tau3,dur3,fsamp);
xx4 = bell(ff4,Io4,tau4,dur4,fsamp);
xx5 = bell(ff5,Io5,tau5,dur5,fsamp);
xx6 = bell(ff6,Io6,tau6,dur6,fsamp);
</pre><h2 id="5">a) Play the sound in each case</h2><pre class="codeinput">soundsc(xx1, fsamp);
pause(dur1);
soundsc(xx2, fsamp);
pause(dur2);
soundsc(xx3, fsamp);
pause(dur3);
soundsc(xx4, fsamp);
pause(dur4);
soundsc(xx5, fsamp);
pause(dur5);
soundsc(xx6, fsamp);

<span class="comment">% Also generate the sound in an audio wave file</span>
audiowrite(<span class="string">'Case1.wav'</span>, xx1, fsamp);
audiowrite(<span class="string">'Case2.wav'</span>, xx2, fsamp);
audiowrite(<span class="string">'Case3.wav'</span>, xx3, fsamp);
audiowrite(<span class="string">'Case4.wav'</span>, xx4, fsamp);
audiowrite(<span class="string">'Case5.wav'</span>, xx5, fsamp);
audiowrite(<span class="string">'Case6.wav'</span>, xx6, fsamp);
</pre><h2 id="6">b) Calculate the fundamental frequency in each case</h2><p>We can verify the correctness of fundamental frequency by listening to the tone of bell sounds. When fo is low, it sounds more thick and strong. When fo is high, it sounds more clear and sharp.</p><pre class="codeinput">fo1 = gcd(ff1(1), ff1(2));
fo2 = gcd(ff2(1), ff2(2));
fo3 = gcd(ff3(1), ff3(2));
fo4 = gcd(ff4(1), ff4(2));
fo5 = gcd(ff5(1), ff5(2));
fo6 = gcd(ff6(1), ff6(2));
</pre><h2 id="7">Result of fo</h2><pre class="codeinput">disp(<span class="string">'b) Fundamental frequency'</span>)
fprintf(<span class="string">'Fundamental frequency of case 1: %d\n'</span>, fo1);
fprintf(<span class="string">'Fundamental frequency of case 2: %d\n'</span>, fo2);
fprintf(<span class="string">'Fundamental frequency of case 3: %d\n'</span>, fo3);
fprintf(<span class="string">'Fundamental frequency of case 4: %d\n'</span>, fo4);
fprintf(<span class="string">'Fundamental frequency of case 5: %d\n'</span>, fo5);
fprintf(<span class="string">'Fundamental frequency of case 6: %d\n'</span>, fo6);
</pre><pre class="codeoutput">b) Fundamental frequency
Fundamental frequency of case 1: 110
Fundamental frequency of case 2: 220
Fundamental frequency of case 3: 110
Fundamental frequency of case 4: 110
Fundamental frequency of case 5: 50
Fundamental frequency of case 6: 50
</pre><h2 id="8">c) Sounds comparing with I(t)</h2><p>Based on the sounds and plots of I(t), I(t) will affect the length we can hear and the noise of the sound. When &#964; goes higher, we can hear a long continuous sound with echo (decay). When &#964; goes extreme low, the sound is more like a percussion.</p><p>Also by the plots, we can know that the f_i(t) has the same behavior as its I(t).</p><pre class="codeinput"><span class="comment">% Generate the I(t) in each case</span>
I_t1 = Io1*bellenv(tau1,dur1,fsamp);
I_t2 = Io2*bellenv(tau2,dur2,fsamp);
I_t3 = Io3*bellenv(tau3,dur3,fsamp);
I_t4 = Io4*bellenv(tau4,dur4,fsamp);
I_t5 = Io5*bellenv(tau5,dur5,fsamp);
I_t6 = Io6*bellenv(tau6,dur6,fsamp);

<span class="comment">% Generate the fi(t) in each case</span>
didt1 = -Io1*exp(-t1/tau1)/tau1;
didt2 = -Io2*exp(-t2/tau2)/tau2;
didt3 = -Io3*exp(-t3/tau3)/tau3;
didt4 = -Io4*exp(-t4/tau4)/tau4;
didt5 = -Io5*exp(-t5/tau5)/tau5;
didt6 = -Io6*exp(-t6/tau6)/tau6;
fi1 = instfreq(ff1(1), ff1(2), I_t1, didt1, fsamp, dur1);
fi2 = instfreq(ff2(1), ff2(2), I_t2, didt2, fsamp, dur2);
fi3 = instfreq(ff3(1), ff3(2), I_t3, didt3, fsamp, dur3);
fi4 = instfreq(ff4(1), ff4(2), I_t4, didt4, fsamp, dur4);
fi5 = instfreq(ff5(1), ff5(2), I_t5, didt5, fsamp, dur5);
fi6 = instfreq(ff6(1), ff6(2), I_t6, didt6, fsamp, dur6);

<span class="comment">% Generate the plots of I(t)</span>
<span class="comment">% Case 1</span>
figure(1)
subplot(2, 1, 1)
plot(t1, I_t1)
title(<span class="string">'I(t) of case 1'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

subplot(2, 1, 2)
plot(t1, fi1)
title(<span class="string">'f_i(t) of case 1'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'f_i(t)'</span>)

<span class="comment">% Case 2</span>
figure(2)
subplot(2, 1, 1)
plot(t2, I_t2)
title(<span class="string">'I(t) of case 2'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

subplot(2, 1, 2)
plot(t2, fi2)
title(<span class="string">'f_i(t) of case 2'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'f_i(t)'</span>)

<span class="comment">% Case 3</span>
figure(3)
subplot(2, 1, 1)
plot(t3, I_t3)
title(<span class="string">'I(t) of case 3'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

subplot(2, 1, 2)
plot(t3, fi3)
title(<span class="string">'f_i(t) of case 3'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'f_i(t)'</span>)

<span class="comment">% Case 4</span>
figure(4)
subplot(2, 1, 1)
plot(t4, I_t4)
title(<span class="string">'I(t) of case 4'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

subplot(2, 1, 2)
plot(t4, fi4)
title(<span class="string">'f_i(t) of case 4'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'f_i(t)'</span>)

<span class="comment">% Case 5</span>
figure(5)
subplot(2, 1, 1)
plot(t5, I_t5)
title(<span class="string">'I(t) of case 5'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

subplot(2, 1, 2)
plot(t5, fi5)
title(<span class="string">'f_i(t) of case 5'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'f_i(t)'</span>)

<span class="comment">% Case 6</span>
figure(6)
subplot(2, 1, 1)
plot(t6, I_t6)
title(<span class="string">'I(t) of case 6'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

subplot(2, 1, 2)
plot(t6, fi6)
title(<span class="string">'f_i(t) of case 6'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'f_i(t)'</span>)
</pre><img vspace="5" hspace="5" src="main_01.png" alt=""> <img vspace="5" hspace="5" src="main_02.png" alt=""> <img vspace="5" hspace="5" src="main_03.png" alt=""> <img vspace="5" hspace="5" src="main_04.png" alt=""> <img vspace="5" hspace="5" src="main_05.png" alt=""> <img vspace="5" hspace="5" src="main_06.png" alt=""> <h2 id="9">d) Spectrogram and I(t)</h2><p>The frequency content changes in spectrogram are also follow the wave behavior (slope) of its I(t). From the spectrogram, we can find a harmonic structure in specific area of frequency that usually considerd as fo</p><pre class="codeinput"><span class="comment">% Case 1</span>
figure(7)
subplot(2, 1, 1)
spectrogram(xx1)
title(<span class="string">'spectrogram of x(t) in case 1'</span>)
subplot(2, 1, 2)
plot(t1, I_t1)
title(<span class="string">'I(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

<span class="comment">% Case 2</span>
figure(8)
subplot(2, 1, 1)
spectrogram(xx2)
title(<span class="string">'spectrogram of x(t) in case 2'</span>)
subplot(2, 1, 2)
plot(t2, I_t2)
title(<span class="string">'I(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

<span class="comment">% Case 3</span>
figure(9)
subplot(2, 1, 1)
spectrogram(xx3)
title(<span class="string">'spectrogram of x(t) in case 3'</span>)
subplot(2, 1, 2)
plot(t3, I_t3)
title(<span class="string">'I(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

<span class="comment">% Case 4</span>
figure(10)
subplot(2, 1, 1)
spectrogram(xx4)
title(<span class="string">'spectrogram of x(t) in case 4'</span>)
subplot(2, 1, 2)
plot(t4, I_t4)
title(<span class="string">'I(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

<span class="comment">% Case 5</span>
figure(11)
subplot(2, 1, 1)
spectrogram(xx5)
title(<span class="string">'spectrogram of x(t) in case 5'</span>)
subplot(2, 1, 2)
plot(t5, I_t5)
title(<span class="string">'I(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)

<span class="comment">% Case 6</span>
figure(12)
subplot(2, 1, 1)
spectrogram(xx6)
title(<span class="string">'spectrogram of x(t) in case 6'</span>)
subplot(2, 1, 2)
plot(t6, I_t6)
title(<span class="string">'I(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'I(t)'</span>)
</pre><img vspace="5" hspace="5" src="main_07.png" alt=""> <img vspace="5" hspace="5" src="main_08.png" alt=""> <img vspace="5" hspace="5" src="main_09.png" alt=""> <img vspace="5" hspace="5" src="main_10.png" alt=""> <img vspace="5" hspace="5" src="main_11.png" alt=""> <img vspace="5" hspace="5" src="main_12.png" alt=""> <h2 id="10">e) Compare between bell wave with A(t)</h2><p>The signal of x(t) in each case totally follow the behavior of its A(t). This is because the swing amplitude of X(t) is effected by the &#964; which controls both A(t) and I(t).</p><pre class="codeinput"><span class="comment">% Generate A(t) in each case</span>
A_t1 = bellenv(tau1,dur1,fsamp);
A_t2 = bellenv(tau2,dur2,fsamp);
A_t3 = bellenv(tau3,dur3,fsamp);
A_t4 = bellenv(tau4,dur4,fsamp);
A_t5 = bellenv(tau5,dur5,fsamp);
A_t6 = bellenv(tau6,dur6,fsamp);

<span class="comment">% Case 1</span>
figure(13)
subplot(2, 1, 1)
plot(t1, xx1)
title(<span class="string">'x(t) versus t in case 1'</span>)
subplot(2, 1, 2)
plot(t1, A_t1)
title(<span class="string">'A(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'A(t)'</span>)

<span class="comment">% Case 2</span>
figure(14)
subplot(2, 1, 1)
plot(t2, xx2)
title(<span class="string">'x(t) versus t in case 2'</span>)
subplot(2, 1, 2)
plot(t2, A_t2)
title(<span class="string">'A(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'A(t)'</span>)

<span class="comment">% Case 3</span>
figure(15)
subplot(2, 1, 1)
plot(t3, xx3)
title(<span class="string">'x(t) versus t in case 3'</span>)
subplot(2, 1, 2)
plot(t3, A_t3)
title(<span class="string">'A(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'A(t)'</span>)

<span class="comment">% Case 4</span>
figure(16)
subplot(2, 1, 1)
plot(t4, xx4)
title(<span class="string">'x(t) versus t in case 4'</span>)
subplot(2, 1, 2)
plot(t4, A_t4)
title(<span class="string">'A(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'A(t)'</span>)

<span class="comment">% Case 5</span>
figure(17)
subplot(2, 1, 1)
plot(t5, xx5)
title(<span class="string">'x(t) versus t in case 5'</span>)
subplot(2, 1, 2)
plot(t5, A_t5)
title(<span class="string">'A(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'A(t)'</span>)

<span class="comment">% Case 6</span>
figure(18)
subplot(2, 1, 1)
plot(t6, xx6)
title(<span class="string">'x(t) versus t in case 6'</span>)
subplot(2, 1, 2)
plot(t6, A_t6)
title(<span class="string">'A(t) versus t'</span>)
xlabel(<span class="string">'t'</span>)
ylabel(<span class="string">'A(t)'</span>)
</pre><img vspace="5" hspace="5" src="main_13.png" alt=""> <img vspace="5" hspace="5" src="main_14.png" alt=""> <img vspace="5" hspace="5" src="main_15.png" alt=""> <img vspace="5" hspace="5" src="main_16.png" alt=""> <img vspace="5" hspace="5" src="main_17.png" alt=""> <img vspace="5" hspace="5" src="main_18.png" alt=""> <h2 id="11">f) Plot of 100-200 samples</h2><p>From the sampled plots above, we can conclude that the bell sound wave is affected by many factors like &#964;, Io, fo, etc. The main factor is the fundamental fo and &#964;. fo highly controls the tone of the sound (thick or sharp).</p><pre class="codeinput"><span class="comment">% Case 1</span>
figure(19)
plot(t1(32900:33100), xx1(32900:33100))
title(<span class="string">'200 Samples of x(t) in case 1'</span>)

<span class="comment">% Case 2</span>
figure(20)
plot(t2(32900:33100), xx2(32900:33100))
title(<span class="string">'200 Samples of x(t) in case 2'</span>)

<span class="comment">% Case 3</span>
figure(21)
plot(t3(12900:13100), xx3(12900:13100))
title(<span class="string">'200 Samples of x(t) in case 3'</span>)

<span class="comment">% Case 4</span>
figure(22)
plot(t4(12900:13100), xx4(12900:13100))
title(<span class="string">'200 Samples of x(t) in case 4'</span>)

<span class="comment">% Case 5</span>
figure(23)
plot(t5(22900:23100), xx5(22900:23100))
title(<span class="string">'200 Samples of x(t) in case 5'</span>)

<span class="comment">% Case 6</span>
figure(24)
plot(t6(22900:23100), xx6(22900:23100))
title(<span class="string">'200 Samples of x(t) in case 6'</span>)
</pre><img vspace="5" hspace="5" src="main_19.png" alt=""> <img vspace="5" hspace="5" src="main_20.png" alt=""> <img vspace="5" hspace="5" src="main_21.png" alt=""> <img vspace="5" hspace="5" src="main_22.png" alt=""> <img vspace="5" hspace="5" src="main_23.png" alt=""> <img vspace="5" hspace="5" src="main_24.png" alt=""> <h2 id="12">4.4 Comments about the Bell</h2><p>After few experiments, we think the choice of ratio 1:2, Io: 2, &#964;: 3 can generate a better sound of bell.</p><pre class="codeinput"><span class="comment">% Change factors</span>
ff_44 = [130 130*2];
Io_44 = 2;
tau_44 = 3;
dur_44 = 6;
t_44 = 0:1/fsamp:dur_44;
xx_44 = bell(ff_44,Io_44,tau_44,dur_44,fsamp);

<span class="comment">% Play the sound and generate audio file</span>
soundsc(xx_44, fsamp);
pause(dur_44);
audiowrite(<span class="string">'bell_44.wav'</span>,xx_44,fsamp,<span class="string">'BitsPerSample'</span>,16);
</pre><h2 id="13">5 C-Major Scale</h2><p>Try to make seven consecutive notes of C-Major Scale</p><pre class="codeinput"><span class="comment">% Generate factors</span>
fc_c = [130.81 146.83 164.81 174.61 196 220 246.94];
Io_c = 2;
tau_c = 3;
dur_c = 1;
yy = 0;

<span class="comment">% Generate the consecutive notes</span>
<span class="keyword">for</span> i = 1:length(fc_c)
    fcc = fc_c(i);
    fm_c = fcc*2;
    ff_c = [fcc fm_c];
    yy = [yy bell(ff_c,Io_c,tau_c,dur_c,fsamp)];
<span class="keyword">end</span>

<span class="comment">% Play the sound and store in audio file</span>
soundsc(yy, fsamp);
audiowrite(<span class="string">'Major_c.wav'</span>,yy,fsamp,<span class="string">'BitsPerSample'</span>,16);
</pre><h2 id="14">Function: Bell Envelope</h2><pre class="codeinput"><span class="keyword">function</span> yy = bellenv(tau, dur, fsamp)
    t = 0:1/fsamp:dur;
    y0 = 1;
    yy = y0*exp(-t/tau);
<span class="keyword">end</span>
</pre><h2 id="15">Function: Bell</h2><pre class="codeinput"><span class="keyword">function</span> xx = bell(ff, Io, tau, dur, fsamp)
    Ao = 1; <span class="comment">% Amplitude value set to 1 as default</span>
    A_t = Ao*bellenv(tau, dur, fsamp); <span class="comment">% Amplitude envelope</span>
    I_t = Io*bellenv(tau, dur, fsamp); <span class="comment">% Modulation index envelope</span>
    t = 0:1/fsamp:dur;
    xx = A_t.*cos(2*pi*ff(1).*t+I_t.*cos(2*pi*ff(2).*t-pi/2)-pi/2);

    <span class="comment">% usage: xx = bell(ff, Io, tau, dur, fsamp)</span>
    <span class="comment">%</span>
    <span class="comment">% where: ff = frequency vector (containing fc and fm)</span>
    <span class="comment">% Io = scale factor for modulation index</span>
    <span class="comment">% tau = decay parameter for A(t) and I(t)</span>
    <span class="comment">% dur = duration (in sec.) of the output signal</span>
    <span class="comment">% fsamp = sampling rate</span>
<span class="keyword">end</span>
</pre><h2 id="16">Function: Instantaneous Frequency</h2><pre class="codeinput"><span class="keyword">function</span> fi = instfreq(fc, fm, I_t, didt, fsamp, dur)
    t = 0:1/fsamp:dur;
    fi = fc-fm*I_t.*sin(2*pi*fm.*t - pi/2) + didt.*cos(2*pi*fm.*t - pi/2);
<span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2021b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% FM Synthesis for Musical Instruments: Lab P-7: 4&5 Lab Exercise

%% Preparation
% Clear the workspace and console
clc;
clear;

%% 4.1 Generating the Bell Envelopes
% The function of the bell envelope is shown at the end of this script.
%

%% 4.2 Parameters for the Bell
% The function of the bell sound generator is shown at the end of this script.
% It also generates amplitude envelope A(t) and modulation index envelope I(t).

%% 4.3 The Bell Sound
% Test the bell function by changing different parameters in 6 different cases.

% Generate ff -> fc & fm
ff1 = [110 220];
ff2 = [220 440];
ff3 = [110 220];
ff4 = [110 220];
ff5 = [250 350];
ff6 = [250 350];

% Generate Io
Io1 = 10;
Io2 = 5;
Io3 = 10;
Io4 = 10;
Io5 = 5;
Io6 = 3;

% Generate tau
tau1 = 2;
tau2 = 2;
tau3 = 12;
tau4 = 0.3;
tau5 = 2;
tau6 = 1;

% Generate duration time Tdur
dur1 = 6;
dur2 = 6;
dur3 = 3;
dur4 = 3;
dur5 = 5;
dur6 = 5;

% Generate fsamp (11025 Hz as default)
fsamp = 11025;

% Generate the time sequence t
t1 = 0:1/fsamp:dur1;
t2 = 0:1/fsamp:dur2;
t3 = 0:1/fsamp:dur3;
t4 = 0:1/fsamp:dur4;
t5 = 0:1/fsamp:dur5;
t6 = 0:1/fsamp:dur6;

% Generate the bell sounds in 6 cases
xx1 = bell(ff1,Io1,tau1,dur1,fsamp);
xx2 = bell(ff2,Io2,tau2,dur2,fsamp);
xx3 = bell(ff3,Io3,tau3,dur3,fsamp);
xx4 = bell(ff4,Io4,tau4,dur4,fsamp);
xx5 = bell(ff5,Io5,tau5,dur5,fsamp);
xx6 = bell(ff6,Io6,tau6,dur6,fsamp);

%% a) Play the sound in each case
soundsc(xx1, fsamp);
pause(dur1);
soundsc(xx2, fsamp);
pause(dur2);
soundsc(xx3, fsamp);
pause(dur3);
soundsc(xx4, fsamp);
pause(dur4);
soundsc(xx5, fsamp);
pause(dur5);
soundsc(xx6, fsamp);

% Also generate the sound in an audio wave file
audiowrite('Case1.wav', xx1, fsamp);
audiowrite('Case2.wav', xx2, fsamp);
audiowrite('Case3.wav', xx3, fsamp);
audiowrite('Case4.wav', xx4, fsamp);
audiowrite('Case5.wav', xx5, fsamp);
audiowrite('Case6.wav', xx6, fsamp);

%% b) Calculate the fundamental frequency in each case
% We can verify the correctness of fundamental frequency by listening to
% the tone of bell sounds. When fo is low, it sounds more thick and strong.
% When fo is high, it sounds more clear and sharp.
fo1 = gcd(ff1(1), ff1(2));
fo2 = gcd(ff2(1), ff2(2));
fo3 = gcd(ff3(1), ff3(2));
fo4 = gcd(ff4(1), ff4(2));
fo5 = gcd(ff5(1), ff5(2));
fo6 = gcd(ff6(1), ff6(2));

%% Result of fo
disp('b) Fundamental frequency')
fprintf('Fundamental frequency of case 1: %d\n', fo1);
fprintf('Fundamental frequency of case 2: %d\n', fo2);
fprintf('Fundamental frequency of case 3: %d\n', fo3);
fprintf('Fundamental frequency of case 4: %d\n', fo4);
fprintf('Fundamental frequency of case 5: %d\n', fo5);
fprintf('Fundamental frequency of case 6: %d\n', fo6);

%% c) Sounds comparing with I(t)
% Based on the sounds and plots of I(t), I(t) will affect the length we
% can hear and the noise of the sound. When τ goes higher, we can hear
% a long continuous sound with echo (decay). When τ goes extreme low,
% the sound is more like a percussion.
% 
% Also by the plots, we can know that the f_i(t) has the same behavior as
% its I(t).
% 

% Generate the I(t) in each case
I_t1 = Io1*bellenv(tau1,dur1,fsamp);
I_t2 = Io2*bellenv(tau2,dur2,fsamp);
I_t3 = Io3*bellenv(tau3,dur3,fsamp);
I_t4 = Io4*bellenv(tau4,dur4,fsamp);
I_t5 = Io5*bellenv(tau5,dur5,fsamp);
I_t6 = Io6*bellenv(tau6,dur6,fsamp);

% Generate the fi(t) in each case
didt1 = -Io1*exp(-t1/tau1)/tau1;
didt2 = -Io2*exp(-t2/tau2)/tau2;
didt3 = -Io3*exp(-t3/tau3)/tau3;
didt4 = -Io4*exp(-t4/tau4)/tau4;
didt5 = -Io5*exp(-t5/tau5)/tau5;
didt6 = -Io6*exp(-t6/tau6)/tau6;
fi1 = instfreq(ff1(1), ff1(2), I_t1, didt1, fsamp, dur1);
fi2 = instfreq(ff2(1), ff2(2), I_t2, didt2, fsamp, dur2);
fi3 = instfreq(ff3(1), ff3(2), I_t3, didt3, fsamp, dur3);
fi4 = instfreq(ff4(1), ff4(2), I_t4, didt4, fsamp, dur4);
fi5 = instfreq(ff5(1), ff5(2), I_t5, didt5, fsamp, dur5);
fi6 = instfreq(ff6(1), ff6(2), I_t6, didt6, fsamp, dur6);

% Generate the plots of I(t)
% Case 1
figure(1)
subplot(2, 1, 1)
plot(t1, I_t1)
title('I(t) of case 1')
xlabel('t')
ylabel('I(t)')

subplot(2, 1, 2)
plot(t1, fi1)
title('f_i(t) of case 1')
xlabel('t')
ylabel('f_i(t)')

% Case 2
figure(2)
subplot(2, 1, 1)
plot(t2, I_t2)
title('I(t) of case 2')
xlabel('t')
ylabel('I(t)')

subplot(2, 1, 2)
plot(t2, fi2)
title('f_i(t) of case 2')
xlabel('t')
ylabel('f_i(t)')

% Case 3
figure(3)
subplot(2, 1, 1)
plot(t3, I_t3)
title('I(t) of case 3')
xlabel('t')
ylabel('I(t)')

subplot(2, 1, 2)
plot(t3, fi3)
title('f_i(t) of case 3')
xlabel('t')
ylabel('f_i(t)')

% Case 4
figure(4)
subplot(2, 1, 1)
plot(t4, I_t4)
title('I(t) of case 4')
xlabel('t')
ylabel('I(t)')

subplot(2, 1, 2)
plot(t4, fi4)
title('f_i(t) of case 4')
xlabel('t')
ylabel('f_i(t)')

% Case 5
figure(5)
subplot(2, 1, 1)
plot(t5, I_t5)
title('I(t) of case 5')
xlabel('t')
ylabel('I(t)')

subplot(2, 1, 2)
plot(t5, fi5)
title('f_i(t) of case 5')
xlabel('t')
ylabel('f_i(t)')

% Case 6
figure(6)
subplot(2, 1, 1)
plot(t6, I_t6)
title('I(t) of case 6')
xlabel('t')
ylabel('I(t)')

subplot(2, 1, 2)
plot(t6, fi6)
title('f_i(t) of case 6')
xlabel('t')
ylabel('f_i(t)')

%% d) Spectrogram and I(t)
% The frequency content changes in spectrogram are also follow the wave
% behavior (slope) of its I(t). From the spectrogram, we can find a harmonic
% structure in specific area of frequency that usually considerd as fo
%

% Case 1
figure(7)
subplot(2, 1, 1)
spectrogram(xx1)
title('spectrogram of x(t) in case 1')
subplot(2, 1, 2)
plot(t1, I_t1)
title('I(t) versus t')
xlabel('t')
ylabel('I(t)')

% Case 2
figure(8)
subplot(2, 1, 1)
spectrogram(xx2)
title('spectrogram of x(t) in case 2')
subplot(2, 1, 2)
plot(t2, I_t2)
title('I(t) versus t')
xlabel('t')
ylabel('I(t)')

% Case 3
figure(9)
subplot(2, 1, 1)
spectrogram(xx3)
title('spectrogram of x(t) in case 3')
subplot(2, 1, 2)
plot(t3, I_t3)
title('I(t) versus t')
xlabel('t')
ylabel('I(t)')

% Case 4
figure(10)
subplot(2, 1, 1)
spectrogram(xx4)
title('spectrogram of x(t) in case 4')
subplot(2, 1, 2)
plot(t4, I_t4)
title('I(t) versus t')
xlabel('t')
ylabel('I(t)')

% Case 5
figure(11)
subplot(2, 1, 1)
spectrogram(xx5)
title('spectrogram of x(t) in case 5')
subplot(2, 1, 2)
plot(t5, I_t5)
title('I(t) versus t')
xlabel('t')
ylabel('I(t)')

% Case 6
figure(12)
subplot(2, 1, 1)
spectrogram(xx6)
title('spectrogram of x(t) in case 6')
subplot(2, 1, 2)
plot(t6, I_t6)
title('I(t) versus t')
xlabel('t')
ylabel('I(t)')

%% e) Compare between bell wave with A(t)
% The signal of x(t) in each case totally follow the behavior of its A(t).
% This is because the swing amplitude of X(t) is effected by the τ which
% controls both A(t) and I(t).

% Generate A(t) in each case
A_t1 = bellenv(tau1,dur1,fsamp);
A_t2 = bellenv(tau2,dur2,fsamp);
A_t3 = bellenv(tau3,dur3,fsamp);
A_t4 = bellenv(tau4,dur4,fsamp);
A_t5 = bellenv(tau5,dur5,fsamp);
A_t6 = bellenv(tau6,dur6,fsamp);

% Case 1
figure(13)
subplot(2, 1, 1)
plot(t1, xx1)
title('x(t) versus t in case 1')
subplot(2, 1, 2)
plot(t1, A_t1)
title('A(t) versus t')
xlabel('t')
ylabel('A(t)')

% Case 2
figure(14)
subplot(2, 1, 1)
plot(t2, xx2)
title('x(t) versus t in case 2')
subplot(2, 1, 2)
plot(t2, A_t2)
title('A(t) versus t')
xlabel('t')
ylabel('A(t)')

% Case 3
figure(15)
subplot(2, 1, 1)
plot(t3, xx3)
title('x(t) versus t in case 3')
subplot(2, 1, 2)
plot(t3, A_t3)
title('A(t) versus t')
xlabel('t')
ylabel('A(t)')

% Case 4
figure(16)
subplot(2, 1, 1)
plot(t4, xx4)
title('x(t) versus t in case 4')
subplot(2, 1, 2)
plot(t4, A_t4)
title('A(t) versus t')
xlabel('t')
ylabel('A(t)')

% Case 5
figure(17)
subplot(2, 1, 1)
plot(t5, xx5)
title('x(t) versus t in case 5')
subplot(2, 1, 2)
plot(t5, A_t5)
title('A(t) versus t')
xlabel('t')
ylabel('A(t)')

% Case 6
figure(18)
subplot(2, 1, 1)
plot(t6, xx6)
title('x(t) versus t in case 6')
subplot(2, 1, 2)
plot(t6, A_t6)
title('A(t) versus t')
xlabel('t')
ylabel('A(t)')

%% f) Plot of 100-200 samples
% From the sampled plots above, we can conclude that the bell sound wave
% is affected by many factors like τ, Io, fo, etc. The main factor is the
% fundamental fo and τ. fo highly controls the tone of the sound (thick
% or sharp).

% Case 1
figure(19)
plot(t1(32900:33100), xx1(32900:33100))
title('200 Samples of x(t) in case 1')

% Case 2
figure(20)
plot(t2(32900:33100), xx2(32900:33100))
title('200 Samples of x(t) in case 2')

% Case 3
figure(21)
plot(t3(12900:13100), xx3(12900:13100))
title('200 Samples of x(t) in case 3')

% Case 4
figure(22)
plot(t4(12900:13100), xx4(12900:13100))
title('200 Samples of x(t) in case 4')

% Case 5
figure(23)
plot(t5(22900:23100), xx5(22900:23100))
title('200 Samples of x(t) in case 5')

% Case 6
figure(24)
plot(t6(22900:23100), xx6(22900:23100))
title('200 Samples of x(t) in case 6')

%% 4.4 Comments about the Bell
% After few experiments, we think the choice of ratio 1:2, Io: 2, τ: 3
% can generate a better sound of bell.

% Change factors
ff_44 = [130 130*2];
Io_44 = 2;
tau_44 = 3;
dur_44 = 6;
t_44 = 0:1/fsamp:dur_44;
xx_44 = bell(ff_44,Io_44,tau_44,dur_44,fsamp);

% Play the sound and generate audio file
soundsc(xx_44, fsamp);
pause(dur_44);
audiowrite('bell_44.wav',xx_44,fsamp,'BitsPerSample',16);

%% 5 C-Major Scale
% Try to make seven consecutive notes of C-Major Scale

% Generate factors
fc_c = [130.81 146.83 164.81 174.61 196 220 246.94];
Io_c = 2;
tau_c = 3;
dur_c = 1;
yy = 0;

% Generate the consecutive notes
for i = 1:length(fc_c)
    fcc = fc_c(i);
    fm_c = fcc*2;
    ff_c = [fcc fm_c];
    yy = [yy bell(ff_c,Io_c,tau_c,dur_c,fsamp)];
end

% Play the sound and store in audio file
soundsc(yy, fsamp);
audiowrite('Major_c.wav',yy,fsamp,'BitsPerSample',16);

%% Function: Bell Envelope
function yy = bellenv(tau, dur, fsamp)
    t = 0:1/fsamp:dur;
    y0 = 1;
    yy = y0*exp(-t/tau);
end

%% Function: Bell
function xx = bell(ff, Io, tau, dur, fsamp)
    Ao = 1; % Amplitude value set to 1 as default
    A_t = Ao*bellenv(tau, dur, fsamp); % Amplitude envelope
    I_t = Io*bellenv(tau, dur, fsamp); % Modulation index envelope
    t = 0:1/fsamp:dur;
    xx = A_t.*cos(2*pi*ff(1).*t+I_t.*cos(2*pi*ff(2).*t-pi/2)-pi/2);

    % usage: xx = bell(ff, Io, tau, dur, fsamp)
    %
    % where: ff = frequency vector (containing fc and fm)
    % Io = scale factor for modulation index
    % tau = decay parameter for A(t) and I(t)
    % dur = duration (in sec.) of the output signal
    % fsamp = sampling rate
end

%% Function: Instantaneous Frequency
function fi = instfreq(fc, fm, I_t, didt, fsamp, dur)
    t = 0:1/fsamp:dur;
    fi = fc-fm*I_t.*sin(2*pi*fm.*t - pi/2) + didt.*cos(2*pi*fm.*t - pi/2);
end
##### SOURCE END #####
--></body></html>